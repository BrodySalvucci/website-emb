{"version":3,"file":"362479e9.js","sources":["../../src/pages/theatre/favorites.tsx"],"sourcesContent":["import type { HolyPage } from '../../App';\nimport { useGlobalSettings } from '../../Layout';\nimport Meta from '../../Meta';\nimport type { LoadingTheatreEntry, TheatreEntry } from '../../TheatreCommon';\nimport { ItemList, TheatreAPI } from '../../TheatreCommon';\nimport { DB_API } from '../../consts';\nimport { isFailedToFetch } from '../../isAbortError';\nimport { Obfuscated } from '../../obfuscate';\nimport styles from '../../styles/TheatreCategory.module.scss';\nimport { useEffect, useState } from 'react';\nimport { useTranslation } from 'react-i18next';\n\nconst FavoritesMeta = () => <Meta title=\"Favorites\" />;\n\nconst Favorites: HolyPage = ({ layout }) => {\n\tconst [settings, setSettings] = useGlobalSettings();\n\tconst { t } = useTranslation('theatre');\n\n\tconst [data, setData] = useState<(TheatreEntry | LoadingTheatreEntry)[]>(() =>\n\t\tsettings.favorites.map((id) => ({\n\t\t\tloading: true,\n\t\t\tid,\n\t\t\tcategory: [],\n\t\t})),\n\t);\n\n\tuseEffect(() => {\n\t\tconst abort = new AbortController();\n\n\t\t(async function () {\n\t\t\tconst api = new TheatreAPI(DB_API, abort.signal);\n\t\t\tconst data = [];\n\n\t\t\tfor (const id of settings.favorites) {\n\t\t\t\ttry {\n\t\t\t\t\tdata.push(await api.show(id));\n\t\t\t\t} catch (err) {\n\t\t\t\t\t// cancelled? page unload?\n\t\t\t\t\tif (!isFailedToFetch(err)) {\n\t\t\t\t\t\tconsole.warn('Unable to fetch entry:', id, err);\n\t\t\t\t\t\tsettings.favorites.splice(settings.favorites.indexOf(id), 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// update settings\n\t\t\tsetSettings({\n\t\t\t\t...settings,\n\t\t\t});\n\n\t\t\tsetData(data);\n\t\t})();\n\n\t\treturn () => abort.abort();\n\t}, [layout, setSettings, settings]);\n\n\tif (settings.favorites.length === 0)\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<FavoritesMeta />\n\t\t\t\t<main className=\"error\">\n\t\t\t\t\t<p>{t('noFavorites')}</p>\n\t\t\t\t</main>\n\t\t\t</>\n\t\t);\n\n\treturn (\n\t\t<>\n\t\t\t<FavoritesMeta />{' '}\n\t\t\t<main className={styles.main}>\n\t\t\t\t<section>\n\t\t\t\t\t<div className={styles.name}>\n\t\t\t\t\t\t<h1>\n\t\t\t\t\t\t\t<Obfuscated>Favorites</Obfuscated>\n\t\t\t\t\t\t</h1>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className={styles.items}>\n\t\t\t\t\t\t<ItemList items={data} />\n\t\t\t\t\t</div>\n\t\t\t\t</section>\n\t\t\t</main>\n\t\t</>\n\t);\n};\n\nexport default Favorites;\n"],"names":["FavoritesMeta","jsx","Meta","Favorites","layout","settings","setSettings","useGlobalSettings","t","useTranslation","data","setData","useState","id","useEffect","abort","api","TheatreAPI","DB_API","err","isFailedToFetch","jsxs","Fragment","styles","Obfuscated","ItemList"],"mappings":"iMAYA,MAAMA,EAAgB,IAAOC,EAAAA,IAAAC,EAAA,CAAK,MAAM,WAAY,CAAA,EAE9CC,EAAsB,CAAC,CAAE,OAAAC,KAAa,CAC3C,KAAM,CAACC,EAAUC,CAAW,EAAIC,EAAkB,EAC5C,CAAE,EAAAC,CAAA,EAAMC,EAAe,SAAS,EAEhC,CAACC,EAAMC,CAAO,EAAIC,EAAA,SAAiD,IACxEP,EAAS,UAAU,IAAKQ,IAAQ,CAC/B,QAAS,GACT,GAAAA,EACA,SAAU,CAAC,CAAA,EACV,CAAA,EAiCC,OA9BJC,EAAAA,UAAU,IAAM,CACT,MAAAC,EAAQ,IAAI,gBAElB,OAAC,gBAAkB,CAClB,MAAMC,EAAM,IAAIC,EAAWC,EAAQH,EAAM,MAAM,EACzCL,EAAO,CAAA,EAEF,UAAAG,KAAMR,EAAS,UACrB,GAAA,CACHK,EAAK,KAAK,MAAMM,EAAI,KAAKH,CAAE,CAAC,QACpBM,EAAK,CAERC,EAAgBD,CAAG,IACf,QAAA,KAAK,yBAA0BN,EAAIM,CAAG,EAC9Cd,EAAS,UAAU,OAAOA,EAAS,UAAU,QAAQQ,CAAE,EAAG,CAAC,EAE7D,CAIWP,EAAA,CACX,GAAGD,CAAA,CACH,EAEDM,EAAQD,CAAI,CAAA,IAGN,IAAMK,EAAM,OACjB,EAAA,CAACX,EAAQE,EAAaD,CAAQ,CAAC,EAE9BA,EAAS,UAAU,SAAW,EAG/BgB,EAAA,KAAAC,WAAA,CAAA,SAAA,CAAArB,EAAA,IAACD,EAAc,EAAA,EACfC,EAAAA,IAAC,QAAK,UAAU,QACf,eAAC,IAAG,CAAA,SAAAO,EAAE,aAAa,CAAA,CAAE,CACtB,CAAA,CACD,CAAA,CAAA,EAKAa,EAAA,KAAAC,WAAA,CAAA,SAAA,CAAArB,EAAA,IAACD,EAAc,EAAA,EAAG,UACjB,OAAK,CAAA,UAAWuB,EAAO,KACvB,gBAAC,UACA,CAAA,SAAA,CAACtB,EAAA,IAAA,MAAA,CAAI,UAAWsB,EAAO,KACtB,SAAAtB,MAAC,MACA,SAACA,EAAA,IAAAuB,EAAA,CAAW,SAAS,WAAA,CAAA,CACtB,CAAA,EACD,EACAvB,EAAAA,IAAC,OAAI,UAAWsB,EAAO,MACtB,SAACtB,EAAA,IAAAwB,EAAA,CAAS,MAAOf,CAAA,CAAM,CACxB,CAAA,CAAA,CAAA,CACD,CACD,CAAA,CACD,CAAA,CAAA,CAEF"}