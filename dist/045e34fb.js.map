{"version":3,"file":"045e34fb.js","sources":["../../src/mask.ts","../../node_modules/@mui/icons-material/Check.js","../../src/pages/settings/tabcloak.tsx"],"sourcesContent":["import { BARE_API } from './consts';\nimport i18n from './i18n';\nimport { BareClient } from '@tomphttp/bare-client';\n\nconst bare = new BareClient(BARE_API);\n\nexport interface ExtractedData {\n\ttitle: string;\n\ticon: string;\n\turl: string;\n}\n\nexport async function extractData(address: string): Promise<ExtractedData> {\n\tconst url = resolveURL(address);\n\n\tif (url === 'about:blank')\n\t\treturn {\n\t\t\ttitle: 'about:blank',\n\t\t\ticon: 'none',\n\t\t\turl: 'about:blank',\n\t\t};\n\n\tconst response = await bare.fetch(url, { redirect: 'follow' });\n\n\tif (!response.ok)\n\t\tthrow new Error(`Response was not OK. Got ${response.status}`);\n\n\tconst parser = new DOMParser();\n\n\tconst dom = parser.parseFromString(`${await response.text()}`, 'text/html');\n\n\tconst base = document.createElement('base');\n\tbase.href = response.finalURL;\n\n\tdom.head.append(base);\n\n\tlet icon: string;\n\n\tconst iconSelector = dom.querySelector(\n\t\t'link[rel*=\"icon\"]',\n\t) as HTMLLinkElement | null;\n\n\tif (iconSelector && iconSelector.href !== '') icon = iconSelector.href;\n\telse icon = new URL('/favicon.ico', url).toString();\n\n\tconst outgoing = await bare.fetch(icon);\n\n\ticon = await blobToDataURL(\n\t\tnew Blob([await outgoing.arrayBuffer()], {\n\t\t\ttype: outgoing.headers.get('content-type')!,\n\t\t}),\n\t);\n\n\tlet title = dom.title;\n\n\tif (!title) {\n\t\tconst url = new URL(response.finalURL);\n\t\ttitle = `${url.host}${url.pathname}${url.search}`;\n\t}\n\n\treturn { icon, title, url: response.finalURL };\n}\n\nconst whitespace = /\\s+/;\nconst protocol = /^\\w+:/;\n\nfunction resolveURL(input: string) {\n\tif (input.match(protocol)) {\n\t\treturn input;\n\t} else if (input.includes('.') && !input.match(whitespace)) {\n\t\treturn `http://${input}`;\n\t} else {\n\t\tthrow new Error(i18n.t('settings:tabMask.validateError'));\n\t}\n}\n\nasync function blobToDataURL(blob: Blob) {\n\tconst reader = new FileReader();\n\n\treturn new Promise<string>((resolve, reject) => {\n\t\treader.addEventListener('load', () => resolve(reader.result as string));\n\t\treader.addEventListener('error', reject);\n\t\treader.readAsDataURL(blob);\n\t});\n}\n","\"use strict\";\n\"use client\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nvar _createSvgIcon = _interopRequireDefault(require(\"./utils/createSvgIcon\"));\nvar _jsxRuntime = require(\"react/jsx-runtime\");\nvar _default = (0, _createSvgIcon.default)( /*#__PURE__*/(0, _jsxRuntime.jsx)(\"path\", {\n  d: \"M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z\"\n}), 'Check');\nexports.default = _default;","import type { HolyPage } from '../../App';\nimport { useGlobalCloakSettings } from '../../Layout';\nimport Meta from '../../Meta';\nimport { ThemeButton, ThemeInputBar, themeStyles } from '../../ThemeElements';\nimport { extractData } from '../../mask';\nimport { Obfuscated } from '../../obfuscate';\nimport styles from '../../styles/Settings.module.scss';\nimport Check from '@mui/icons-material/Check';\nimport clsx from 'clsx';\nimport { useRef } from 'react';\nimport { useTranslation } from 'react-i18next';\n\nconst TabCloakMeta = () => <Meta title=\"Tab Cloak Settings\" />;\n\nconst TabCloak: HolyPage = ({ layout }) => {\n\tconst { t } = useTranslation(['settings', 'commonError']);\n\tconst [cloak, setCloak] = useGlobalCloakSettings();\n\tconst input = useRef<HTMLInputElement | null>(null);\n\n\tasync function onSubmit() {\n\t\ttry {\n\t\t\tlayout.current!.notifications.current!({\n\t\t\t\tdescription: t('settings:tabMask.notification.fetching'),\n\t\t\t\ttype: 'info',\n\t\t\t});\n\n\t\t\tconst data = await extractData(input.current!.value);\n\t\t\tinput.current!.value = data.url;\n\t\t\tsetCloak(data);\n\n\t\t\tlayout.current!.notifications.current!({\n\t\t\t\tdescription: t('settings:tabMask.notification.set'),\n\t\t\t\ttype: 'success',\n\t\t\t});\n\t\t} catch (err) {\n\t\t\tconsole.error(err);\n\n\t\t\tlayout.current!.notifications.current!({\n\t\t\t\ttitle: t('settings:tabMask.notification.failure'),\n\t\t\t\tdescription:\n\t\t\t\t\terr instanceof Error\n\t\t\t\t\t\t? err.message\n\t\t\t\t\t\t: (t('commonError:unknownError') as string),\n\t\t\t\ttype: 'error',\n\t\t\t});\n\t\t}\n\t}\n\n\treturn (\n\t\t<>\n\t\t\t<TabCloakMeta />\n\t\t\t<section>\n\t\t\t\t<p>\n\t\t\t\t\t<Obfuscated>{t('settings:tabMask.description')}</Obfuscated>\n\t\t\t\t</p>\n\t\t\t\t<div>\n\t\t\t\t\t<p>\n\t\t\t\t\t\t<Obfuscated>{t('settings:tabMask.urlField')}</Obfuscated>:\n\t\t\t\t\t</p>\n\t\t\t\t\t<form\n\t\t\t\t\t\tonSubmit={(event) => {\n\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t\tonSubmit();\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<ThemeInputBar className={styles.ThemeInputBar}>\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\tclassName={themeStyles.themePadRight}\n\t\t\t\t\t\t\t\tdefaultValue={cloak.url}\n\t\t\t\t\t\t\t\tplaceholder=\"https://example.org/\"\n\t\t\t\t\t\t\t\tref={input}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<Check\n\t\t\t\t\t\t\t\tonClick={onSubmit}\n\t\t\t\t\t\t\t\tclassName={clsx(themeStyles.button, themeStyles.right)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</ThemeInputBar>\n\t\t\t\t\t</form>\n\t\t\t\t</div>\n\t\t\t\t<div>\n\t\t\t\t\t<ThemeButton\n\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\tsetCloak({\n\t\t\t\t\t\t\t\ttitle: '',\n\t\t\t\t\t\t\t\ticon: '',\n\t\t\t\t\t\t\t\turl: '',\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tinput.current!.value = '';\n\n\t\t\t\t\t\t\tlayout.current!.notifications.current!({\n\t\t\t\t\t\t\t\tdescription: t('settings:tabMask.notification.reset'),\n\t\t\t\t\t\t\t\ttype: 'info',\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<Obfuscated>{t('settings:tabMask.resetButton')}</Obfuscated>\n\t\t\t\t\t</ThemeButton>\n\t\t\t\t</div>\n\t\t\t</section>\n\t\t</>\n\t);\n};\n\nexport default TabCloak;\n"],"names":["bare","BareClient","BARE_API","extractData","address","url","resolveURL","response","dom","base","icon","iconSelector","outgoing","blobToDataURL","title","whitespace","protocol","input","i18n","blob","reader","resolve","reject","_interopRequireDefault","require$$0","Check","default_1","_createSvgIcon","require$$1","_jsxRuntime","require$$2","_default","TabCloakMeta","jsx","Meta","TabCloak","layout","useTranslation","cloak","setCloak","useGlobalCloakSettings","useRef","onSubmit","data","err","jsxs","Fragment","Obfuscated","event","ThemeInputBar","styles","themeStyles","clsx","ThemeButton"],"mappings":"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","x_google_ignoreList":[1]}