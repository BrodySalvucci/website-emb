{"version":3,"file":"7a594642.js","sources":["../../src/pages/compat/flash.tsx"],"sourcesContent":["import type { HolyPage } from '../../App';\nimport type { ScriptRef } from '../../CompatLayout';\nimport { getDestination, Script } from '../../CompatLayout';\nimport { VITE_PUBLIC_PATH } from '../../routes';\nimport styles from '../../styles/CompatFlash.module.scss';\nimport { useEffect, useRef, useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { useLocation } from 'react-router-dom';\n\ninterface RufflePlayerElement extends HTMLElement {\n\tload(data: { url: string }): void;\n\tremove(): void;\n}\n\ndeclare const RufflePlayer: {\n\tnewest(): {\n\t\tcreatePlayer(): RufflePlayerElement;\n\t};\n};\n\nconst Flash: HolyPage = ({ compatLayout }) => {\n\tconst { t } = useTranslation('compat');\n\tconst location = useLocation();\n\tconst container = useRef<HTMLElement | null>(null);\n\tconst ruffleBundle = useRef<ScriptRef | null>(null);\n\tconst [ruffleLoaded, setRuffleLoaded] = useState(false);\n\n\tuseEffect(() => {\n\t\tlet player: RufflePlayerElement | undefined;\n\n\t\t(async function () {\n\t\t\tif (!ruffleBundle.current || !container.current) return;\n\n\t\t\tlet errorCause: string | undefined;\n\n\t\t\ttry {\n\t\t\t\terrorCause = t('error.generic', { what: 'Ruffle' });\n\t\t\t\tawait ruffleBundle.current.promise;\n\t\t\t\terrorCause = undefined;\n\n\t\t\t\tconst ruffle = RufflePlayer.newest();\n\t\t\t\tplayer = ruffle.createPlayer();\n\t\t\t\tcontainer.current.append(player);\n\n\t\t\t\tplayer.addEventListener('loadeddata', () => {\n\t\t\t\t\tsetRuffleLoaded(true);\n\t\t\t\t});\n\n\t\t\t\tplayer.addEventListener('error', (event) => {\n\t\t\t\t\tthrow event.error;\n\t\t\t\t});\n\n\t\t\t\tplayer.load({\n\t\t\t\t\turl: getDestination(location),\n\t\t\t\t});\n\t\t\t} catch (err) {\n\t\t\t\tcompatLayout.current!.report(err, errorCause, 'Rammerhead');\n\t\t\t}\n\t\t})();\n\n\t\treturn () => {\n\t\t\tplayer?.remove();\n\t\t};\n\t}, [compatLayout, location, ruffleBundle, t]);\n\n\treturn (\n\t\t<main\n\t\t\tclassName={styles.main}\n\t\t\tdata-loaded={Number(ruffleLoaded)}\n\t\t\tref={container}\n\t\t>\n\t\t\t<Script src={`${VITE_PUBLIC_PATH}/ruffle/ruffle.js`} ref={ruffleBundle} />\n\t\t\t{!ruffleLoaded && t('loading', { what: 'Flash Player' })}\n\t\t</main>\n\t);\n};\n\nexport default Flash;\n"],"names":["Flash","compatLayout","t","useTranslation","location","useLocation","container","useRef","ruffleBundle","ruffleLoaded","setRuffleLoaded","useState","useEffect","player","errorCause","event","getDestination","err","jsxs","styles","jsx","Script","VITE_PUBLIC_PATH"],"mappings":"4HAoBMA,EAAkB,CAAC,CAAE,aAAAC,KAAmB,CAC7C,KAAM,CAAE,EAAAC,CAAA,EAAMC,EAAe,QAAQ,EAC/BC,EAAWC,IACXC,EAAYC,SAA2B,IAAI,EAC3CC,EAAeD,SAAyB,IAAI,EAC5C,CAACE,EAAcC,CAAe,EAAIC,WAAS,EAAK,EAEtDC,OAAAA,EAAAA,UAAU,IAAM,CACX,IAAAC,EAEJ,OAAC,gBAAkB,CAClB,GAAI,CAACL,EAAa,SAAW,CAACF,EAAU,QAAS,OAE7C,IAAAQ,EAEA,GAAA,CACHA,EAAaZ,EAAE,gBAAiB,CAAE,KAAM,QAAU,CAAA,EAClD,MAAMM,EAAa,QAAQ,QACdM,EAAA,OAGbD,EADe,aAAa,SACZ,eACNP,EAAA,QAAQ,OAAOO,CAAM,EAExBA,EAAA,iBAAiB,aAAc,IAAM,CAC3CH,EAAgB,EAAI,CAAA,CACpB,EAEMG,EAAA,iBAAiB,QAAUE,GAAU,CAC3C,MAAMA,EAAM,KAAA,CACZ,EAEDF,EAAO,KAAK,CACX,IAAKG,EAAeZ,CAAQ,CAAA,CAC5B,QACOa,EAAK,CACbhB,EAAa,QAAS,OAAOgB,EAAKH,EAAY,YAAY,CAC3D,CAAA,IAGM,IAAM,CACZD,GAAA,MAAAA,EAAQ,QAAO,GAEd,CAACZ,EAAcG,EAAUI,EAAcN,CAAC,CAAC,EAG3CgB,EAAA,KAAC,OAAA,CACA,UAAWC,EAAO,KAClB,cAAa,OAAOV,CAAY,EAChC,IAAKH,EAEL,SAAA,CAAAc,MAACC,GAAO,IAAK,GAAGC,CAAgB,oBAAqB,IAAKd,EAAc,EACvE,CAACC,GAAgBP,EAAE,UAAW,CAAE,KAAM,eAAgB,CAAA,CAAA,CAAA,CAG1D"}