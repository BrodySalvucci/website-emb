var Y=Object.defineProperty;var Z=(c,e,o)=>e in c?Y(c,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):c[e]=o;var P=(c,e,o)=>(Z(c,typeof e!="symbol"?e+"":e,o),o);import{l as F,m as H,j as n,r as t,B as V,n as J,u as G,o as ee,f as te,p as ne,q as se,s as re,t as U,v as oe,w as W}from"./assets/index-25a0d8c7.js";import{d as ae,r as q}from"./22b5cfdb.js";import{i as ce,a as ie,b as ue}from"./d3d01167.js";import{d as le}from"./e676146e.js";import{B as K}from"./c766964c.js";import{e as $}from"./9ebd4c37.js";import{d as z}from"./873f084d.js";const de=/\s/,fe=/^https?:\/\//;class D{constructor(e){P(this,"template");this.template=e}query(e){return e=String(e),e.match(fe)?e:e.includes(".")&&!e.match(de)?`http://${e}`:this.template.replace("%s",encodeURIComponent(e))}}const he="_service_ak76z_5",me="_headless_ak76z_24",pe="_embed_ak76z_27",be="_buttons_ak76z_36",xe="_icon_ak76z_46",_e="_title_ak76z_52",ve="_shiftRight_ak76z_59",we="_button_ak76z_36",p={service:he,headless:me,embed:pe,buttons:be,icon:xe,title:_e,shiftRight:ve,button:we};var A={},ge=H;Object.defineProperty(A,"__esModule",{value:!0});var Q=A.default=void 0,ye=ge(F()),Se=n,je=(0,ye.default)((0,Se.jsx)("path",{d:"M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"}),"OpenInNew");Q=A.default=je;const ke=({layout:c,src:e,close:o})=>{const r=t.useRef(null),[f,E]=t.useState(!1),[k,x]=t.useState(!1),[_,b]=t.useState(""),M=t.useMemo(()=>new K(V),[]),v=t.useMemo(()=>new WeakMap,[]),[g]=J(),[L,I]=t.useState((e==null?void 0:e[0])||null),[l,y]=t.useState(""),{t:h}=G();t.useEffect(()=>{if(e){if(!r.current||!r.current.contentWindow)return;try{r.current.contentWindow.location.href=e[1],b(e[1])}catch(i){console.error(i),c.current.notifications.current({title:h("error.compatibleProxy"),description:ce(i)?i.message:String(i),type:"error"})}}else{if(!r.current||!r.current.contentWindow)return;E(!1),I(""),y(""),r.current.contentWindow.location.href="about:blank",b("about:blank")}},[r,c,g.proxy,e,h]),t.useEffect(()=>{function i(){!r.current||!r.current.contentWindow||r.current.contentWindow.focus()}return window.addEventListener("focus",i),()=>window.removeEventListener("focus",i)},[r]);const S=t.useCallback(async function(){if(!r.current||!r.current.contentWindow)return;const m=r.current.contentWindow;try{b(m.location.href)}catch{return}const d=new m.Function("return location")();if(d===m.location)I((e==null?void 0:e[0])||null);else{const C=m.document.title;I(C||d.toString());const N=m.document.querySelector('link[rel*="icon"]'),R=N&&N.href!==""?N.href:new URL("/favicon.ico",d).toString();if(v.has(d)||v.set(d,new Set),!v.get(d).has(R)){v.get(d).add(R);const B=await M.fetch(R);y(URL.createObjectURL(await B.blob())),x(!0)}}},[M,r,v,e]);return t.useEffect(()=>{const i=setInterval(S,50);return S(),()=>clearInterval(i)},[S]),t.useEffect(()=>(document.documentElement.dataset.service=(+!!e).toString(),()=>{delete document.documentElement.dataset.service}),[e]),n.jsxs("div",{className:p.service,children:[n.jsxs("div",{className:p.buttons,children:[n.jsx(le,{className:p.button,onClick:o}),l?n.jsx("img",{className:p.icon,alt:"",src:l,onError:()=>y(""),onLoad:()=>{k&&(URL.revokeObjectURL(l),x(!1))}}):n.jsx(ee,{className:p.icon}),n.jsx("p",{className:p.title,children:n.jsx(te,{ellipsis:!0,children:L})}),n.jsx("div",{className:p.shiftRight}),n.jsx("a",{href:_,className:p.button,children:n.jsx(Q,{})}),n.jsx(ae,{className:p.button,onClick:()=>r.current&&r.current.requestFullscreen()})]}),n.jsx("iframe",{className:p.embed,title:"embed",ref:r,"data-first-load":Number(f),onLoad:()=>{S(),e&&E(!0)}})]})},Ne=c=>{const e=window.open("about:blank");if(!e)throw new Error("Could not create new window");e.addEventListener("DOMContentLoaded",()=>{const o=e.document.createElement("iframe");o.src=c,o.style.border="none",o.style.position="absolute",o.style.top="0px",o.style.left="0px",o.style.width="100%",o.style.height="100%",e.document.body.append(o)},{once:!0})},Re="_omnibox_1sehi_5",Ee="_search_1sehi_13",Le="_open_1sehi_14",Ie="_ThemeInputBar_1sehi_27",Ce="_suggested_1sehi_51",Me="_option_1sehi_70",qe="_hover_1sehi_78",Be="_text_1sehi_81",w={omnibox:Re,search:Ee,open:Le,ThemeInputBar:Ie,suggested:Ce,option:Me,hover:qe,text:Be},T=document.createElement("div");function Te(c){T.innerHTML=c;const{textContent:e}=T;return T.innerHTML="",e}var O={},Ae=H;Object.defineProperty(O,"__esModule",{value:!0});var X=O.default=void 0,Oe=Ae(F()),Pe=n,Ue=(0,Oe.default)((0,Pe.jsx)("path",{d:"M5 15h2V8.41L18.59 20 20 18.59 8.41 7H15V5H5v10z"}),"NorthWest");X=O.default=Ue;const Ge=({className:c,placeholder:e,layout:o})=>{const{t:r}=G("proxy"),f=t.useRef(null),E=t.useRef(null),k=t.useRef(null),[x,_]=t.useState(-1),[b,M]=t.useState([]),[v,g]=t.useState(!1),L=t.useRef(new AbortController),I=t.useMemo(()=>new K(V),[]),[l]=J(),y=$.find(s=>s.format===l.search)||$[0],[h,S]=ne(),[i,m]=t.useState(null);t.useEffect(()=>{const s=new AbortController;return(async()=>{if(h.has("q")){const a=new D(y.format).query(h.get("q"));m([a,await q(a,l.proxy,s.signal)])}})(),()=>s.abort()},[h,S,y,l.proxy]),t.useEffect(()=>{const s=h.get("src");s&&m(JSON.parse(se(s)))},[]),t.useEffect(()=>{i?h.set("src",re(JSON.stringify(i))):h.delete("src"),S(h)},[i]);async function d(){if(E.current!==f.current.value){E.current=f.current.value;const s=[];try{L.current.abort(),L.current=new AbortController;const a=await I.fetch("https://www.bing.com/AS/Suggestions?"+new URLSearchParams({qry:f.current.value,cvid:"",bareServer:""}),{signal:L.current.signal});if(!a.ok)throw await a.text();const u=await a.text();for(const[,j]of u.matchAll(/<span class="sa_tm_text">(.*?)<\/span>/g))s.push(j)}catch(a){if(ie(a)||ue(a))console.error("Error fetching Bare server.");else throw a}M(s)}}async function C(){const s=x===-1||k.current==="input"?f.current.value:Te(b[x]);f.current.value=s;const u=new D(l.search).query(f.current.value);switch(g(!1),l.proxyMode){case"embedded":m([u,await q(u,l.proxy)]);break;case"redirect":window.location.assign(await q(u,l.proxy));break;case"about:blank":Ne(await q(u,l.proxy));break}d()}const N=v&&b.length!==0,R=t.useRef(null),B=t.useRef(null);return n.jsxs(n.Fragment,{children:[n.jsx(ke,{src:i,close:()=>m(null),layout:o}),n.jsxs("form",{className:U(w.omnibox,c),"data-suggested":Number(N),"data-focused":Number(v),onSubmit:s=>{s.preventDefault(),C()},onBlur:s=>{R.current.contains(s.relatedTarget)||g(!1)},ref:R,children:[n.jsxs(oe,{className:w.ThemeInputBar,children:[n.jsx(z,{className:W.icon}),n.jsx("input",{type:"text",placeholder:e||r("search",{engine:y.name}),required:x===-1,autoComplete:"off",className:W.thinPadLeft,ref:f,onInput:d,onFocus:()=>{d(),g(!0),_(-1)},onClick:()=>{d(),g(!0),_(-1)},onChange:()=>{k.current="input",_(-1)},onKeyDown:s=>{let a=!0;switch(s.code){case"Escape":g(!1);break;case"ArrowDown":case"ArrowUp":{const u=x;let j;switch(s.code){case"ArrowDown":u>=b.length-1?j=0:j=u+1;break;case"ArrowUp":u<=0?j=b.length-1:j=u-1;break}k.current="select",_(j)}break;default:a=!1;break}a&&s.preventDefault()}})]}),n.jsx("div",{ref:B,className:w.suggested,onMouseLeave:()=>{_(-1)},children:N&&b.map((s,a)=>{const u=t.createRef();return n.jsxs("div",{tabIndex:0,className:U(w.option,a===x&&w.hover),onClick:()=>{k.current="select",f.current.value=u.current.textContent,C()},onMouseOver:()=>{_(a)},children:[n.jsx(z,{className:w.search}),n.jsx("span",{className:w.text,ref:u,dangerouslySetInnerHTML:{__html:s}}),n.jsx(X,{className:w.open})]},a)})})]})]})};export{Ge as P};
//# sourceMappingURL=e075b200.js.map
