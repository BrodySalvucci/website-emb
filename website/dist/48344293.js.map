{"version":3,"file":"48344293.js","sources":["../../src/TheatreSearchBar.tsx"],"sourcesContent":["import type { CategoryData } from './TheatreCommon';\nimport { TheatreAPI } from './TheatreCommon';\nimport { ThemeInputBar, themeStyles } from './ThemeElements';\nimport { DB_API } from './consts';\nimport type { categoryKey } from './gameCategories';\nimport categories from './gameCategories';\nimport isAbortError from './isAbortError';\nimport { Obfuscated } from './obfuscate';\nimport { getHot } from './routes';\nimport styles from './styles/TheatreSearch.module.scss';\nimport Search from '@mui/icons-material/Search';\nimport clsx from 'clsx';\nimport { useRef, useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { Link, useNavigate } from 'react-router-dom';\n\nconst LIMIT = 8;\n\nconst SearchBar = ({\n\tcategory,\n\tplaceholder,\n\tshowCategory,\n}: {\n\tcategory: string;\n\tplaceholder?: string;\n\tshowCategory?: boolean;\n}) => {\n\tconst { t } = useTranslation('gameCategory');\n\tconst navigate = useNavigate();\n\tconst input = useRef<HTMLInputElement | null>(null);\n\tconst bar = useRef<HTMLDivElement | null>(null);\n\tconst [categoryData, setCategoryData] = useState<CategoryData>({\n\t\ttotal: 0,\n\t\tentries: [],\n\t});\n\tconst [lastSelect, setLastSelect] = useState(-1);\n\tconst [inputFocused, setInputFocused] = useState(false);\n\tconst searchAbort = useRef(new AbortController());\n\n\tasync function search(query: string) {\n\t\tsearchAbort.current.abort();\n\t\tsearchAbort.current = new AbortController();\n\n\t\tconst api = new TheatreAPI(DB_API, searchAbort.current.signal);\n\n\t\ttry {\n\t\t\tconst categoryData = await api.category({\n\t\t\t\tsort: 'search',\n\t\t\t\tsearch: query,\n\t\t\t\tlimit: LIMIT,\n\t\t\t\tcategory,\n\t\t\t});\n\n\t\t\tsetCategoryData(categoryData);\n\t\t} catch (err) {\n\t\t\tif (!isAbortError(err)) {\n\t\t\t\tconsole.error(err);\n\t\t\t}\n\t\t}\n\t}\n\n\tconst renderSuggested = inputFocused && categoryData.entries.length !== 0;\n\n\treturn (\n\t\t<div\n\t\t\tclassName={styles.search}\n\t\t\tdata-focused={Number(inputFocused)}\n\t\t\tdata-suggested={Number(renderSuggested)}\n\t\t\tref={bar}\n\t\t\tonBlur={(event) => {\n\t\t\t\tif (!bar.current!.contains(event.relatedTarget)) {\n\t\t\t\t\tsetInputFocused(false);\n\t\t\t\t}\n\t\t\t}}\n\t\t>\n\t\t\t<ThemeInputBar className={styles.ThemeInputBar}>\n\t\t\t\t<Search className={themeStyles.icon} />\n\t\t\t\t<input\n\t\t\t\t\tref={input}\n\t\t\t\t\ttype=\"text\"\n\t\t\t\t\tclassName={themeStyles.thinPadLeft}\n\t\t\t\t\tplaceholder={placeholder}\n\t\t\t\t\tonFocus={() => {\n\t\t\t\t\t\tsetInputFocused(true);\n\t\t\t\t\t\tsetLastSelect(-1);\n\t\t\t\t\t\tsearch(input.current!.value);\n\t\t\t\t\t}}\n\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\tsetInputFocused(true);\n\t\t\t\t\t\tsetLastSelect(-1);\n\t\t\t\t\t\tsearch(input.current!.value);\n\t\t\t\t\t}}\n\t\t\t\t\tonKeyDown={(event) => {\n\t\t\t\t\t\tlet preventDefault = true;\n\n\t\t\t\t\t\tswitch (event.code) {\n\t\t\t\t\t\t\tcase 'Escape':\n\t\t\t\t\t\t\t\tsetInputFocused(false);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'ArrowDown':\n\t\t\t\t\t\t\tcase 'ArrowUp':\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tconst lastI = lastSelect;\n\n\t\t\t\t\t\t\t\t\tlet next;\n\n\t\t\t\t\t\t\t\t\tswitch (event.code) {\n\t\t\t\t\t\t\t\t\t\tcase 'ArrowDown':\n\t\t\t\t\t\t\t\t\t\t\tif (lastI >= categoryData.entries.length - 1) {\n\t\t\t\t\t\t\t\t\t\t\t\tnext = 0;\n\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\tnext = lastI + 1;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\tcase 'ArrowUp':\n\t\t\t\t\t\t\t\t\t\t\tif (lastI <= 0) {\n\t\t\t\t\t\t\t\t\t\t\t\tnext = categoryData.entries.length - 1;\n\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\tnext = lastI - 1;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\t// no default\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tsetLastSelect(next);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'Enter':\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tconst entry = categoryData.entries[lastSelect];\n\n\t\t\t\t\t\t\t\t\tif (entry) {\n\t\t\t\t\t\t\t\t\t\tinput.current!.blur();\n\t\t\t\t\t\t\t\t\t\tsetInputFocused(false);\n\t\t\t\t\t\t\t\t\t\tnavigate(`${getHot('theatre player').path}?id=${entry.id}`);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\tpreventDefault = false;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t// no default\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (preventDefault) {\n\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t}\n\t\t\t\t\t}}\n\t\t\t\t\tonChange={(event) => {\n\t\t\t\t\t\tsearch(event.target.value);\n\t\t\t\t\t\tsetLastSelect(-1);\n\t\t\t\t\t}}\n\t\t\t\t></input>\n\t\t\t</ThemeInputBar>\n\t\t\t<div\n\t\t\t\tclassName={styles.suggested}\n\t\t\t\tonMouseLeave={() => {\n\t\t\t\t\tsetLastSelect(-1);\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t{renderSuggested &&\n\t\t\t\t\tcategoryData.entries.map((entry, i) => (\n\t\t\t\t\t\t<Link\n\t\t\t\t\t\t\ttabIndex={0}\n\t\t\t\t\t\t\tkey={entry.id}\n\t\t\t\t\t\t\tonClick={() => setInputFocused(false)}\n\t\t\t\t\t\t\tonMouseOver={() => setLastSelect(i)}\n\t\t\t\t\t\t\tto={`${getHot('theatre player').path}?id=${entry.id}`}\n\t\t\t\t\t\t\ttitle={entry.name}\n\t\t\t\t\t\t\tclassName={clsx(styles.option, i === lastSelect && styles.hover)}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div className={styles.name}>\n\t\t\t\t\t\t\t\t<Obfuscated ellipsis>{entry.name}</Obfuscated>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{showCategory && entry.category[0] && (\n\t\t\t\t\t\t\t\t<div className={styles.category}>\n\t\t\t\t\t\t\t\t\t{t(\n\t\t\t\t\t\t\t\t\t\tcategories.find(\n\t\t\t\t\t\t\t\t\t\t\t(category) => category.id === entry.category[0],\n\t\t\t\t\t\t\t\t\t\t)?.id as categoryKey,\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</Link>\n\t\t\t\t\t))}\n\t\t\t</div>\n\t\t</div>\n\t);\n};\n\nexport default SearchBar;\n"],"names":["LIMIT","SearchBar","category","placeholder","showCategory","t","useTranslation","navigate","useNavigate","input","useRef","bar","categoryData","setCategoryData","useState","lastSelect","setLastSelect","inputFocused","setInputFocused","searchAbort","search","query","api","TheatreAPI","DB_API","err","isAbortError","renderSuggested","jsxs","styles","event","ThemeInputBar","jsx","Search","themeStyles","preventDefault","lastI","next","entry","getHot","i","Link","clsx","Obfuscated","_a","categories"],"mappings":"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"}