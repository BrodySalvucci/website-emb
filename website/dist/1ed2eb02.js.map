{"version":3,"file":"1ed2eb02.js","sources":["../../src/TheatreCommon.tsx"],"sourcesContent":["import DatabaseAPI from './DatabaseAPI';\nimport { THEATRE_CDN } from './consts';\nimport { Obfuscated } from './obfuscate';\nimport { getHot } from './routes';\nimport styles from './styles/TheatreCategory.module.scss';\nimport clsx from 'clsx';\nimport { useState } from 'react';\nimport { Link } from 'react-router-dom';\n\n/**\n * one of the above types or a letter/key such as A,B,TAB,SPACE,SHIFT\n */\nexport type KeyLike =\n\t| 'mouseleft'\n\t| 'mouseright'\n\t| 'scrollup'\n\t| 'scrolldown'\n\t| 'wasd'\n\t| 'arrows'\n\t| string;\n\nexport interface Control {\n\tkeys: KeyLike[];\n\tlabel: string;\n}\n\nexport interface TheatreEntry {\n\ttype:\n\t\t| 'emulator.nes'\n\t\t| 'emulator.gba'\n\t\t| 'emulator.n64'\n\t\t| 'emulator.genesis'\n\t\t| 'flash'\n\t\t| 'embed'\n\t\t| 'proxy'\n\t\t| string;\n\tcontrols: Control[];\n\tcategory: string[];\n\tid: string;\n\tname: string;\n\tplays: number;\n\tsrc: string;\n}\n\nexport interface LoadingTheatreEntry {\n\tid: string;\n\tloading: true;\n\tcategory: string[];\n}\n\nexport interface CategoryData {\n\ttotal: number;\n\tentries: TheatreEntry[];\n}\n\nexport interface LoadingCategoryData {\n\ttotal: number;\n\tentries: (TheatreEntry | LoadingTheatreEntry)[];\n\tloading: true;\n}\n\nexport interface TheatreEntry {\n\ttype:\n\t\t| 'emulator.nes'\n\t\t| 'emulator.gba'\n\t\t| 'emulator.n64'\n\t\t| 'emulator.genesis'\n\t\t| 'flash'\n\t\t| 'embed'\n\t\t| 'proxy'\n\t\t| string;\n\tcontrols: Control[];\n\tcategory: string[];\n\tid: string;\n\tname: string;\n\tplays: number;\n\tsrc: string;\n}\nexport function isLoading(\n\tdata: CategoryData | LoadingCategoryData,\n): data is LoadingCategoryData;\n\nexport function isLoading(\n\tdata: TheatreEntry | LoadingTheatreEntry,\n): data is LoadingTheatreEntry;\n\nexport function isLoading(\n\tdata: TheatreEntry | LoadingTheatreEntry | CategoryData | LoadingCategoryData,\n): data is LoadingTheatreEntry | LoadingCategoryData {\n\treturn 'loading' in data && data.loading === true;\n}\n\nexport class TheatreAPI extends DatabaseAPI {\n\tasync show(id: String) {\n\t\treturn await this.fetch<TheatreEntry>(`./theatre/${id}/`);\n\t}\n\tasync plays(id: string) {\n\t\treturn await this.fetch<TheatreEntry>(`./theatre/${id}/plays`, {\n\t\t\tmethod: 'PUT',\n\t\t});\n\t}\n\tasync category(params: {\n\t\tleastGreatest?: boolean;\n\t\tsort?: string;\n\t\tcategory?: string;\n\t\tsearch?: string;\n\t\toffset?: number;\n\t\tlimit?: number;\n\t\tlimitPerCategory?: number;\n\t}) {\n\t\treturn await this.fetch<CategoryData>(\n\t\t\t'./theatre/?' + new URLSearchParams(this.sortParams(params)),\n\t\t);\n\t}\n}\n\nexport function Item({ id, name }: { id: string; name: string }) {\n\tconst [loaded, setLoaded] = useState(false);\n\n\treturn (\n\t\t<Link\n\t\t\tclassName={styles.item}\n\t\t\tto={`${getHot('theatre player').path}?id=${id}`}\n\t\t\ttitle={name}\n\t\t>\n\t\t\t<div className={styles.thumbnail} data-loaded={Number(loaded)}>\n\t\t\t\t<img\n\t\t\t\t\talt=\"\"\n\t\t\t\t\tloading=\"lazy\"\n\t\t\t\t\tonLoad={() => setLoaded(true)}\n\t\t\t\t\tsrc={new URL(`./thumbnails/${id}.webp`, THEATRE_CDN).toString()}\n\t\t\t\t></img>\n\t\t\t</div>\n\t\t\t<div className={styles.name}>\n\t\t\t\t<Obfuscated ellipsis>{name}</Obfuscated>\n\t\t\t</div>\n\t\t</Link>\n\t);\n}\n\nexport function LoadingItem() {\n\treturn (\n\t\t<div className={clsx(styles.item, styles.loading)}>\n\t\t\t<div className={styles.thumbnail} />\n\t\t\t<div className={styles.name} />\n\t\t</div>\n\t);\n}\n\nexport function ItemList({\n\titems,\n\t...attributes\n}: JSX.IntrinsicElements['div'] & {\n\titems: (TheatreEntry | LoadingTheatreEntry)[];\n}) {\n\tconst children = [];\n\n\tfor (const item of items) {\n\t\tif (isLoading(item)) {\n\t\t\tchildren.push(<LoadingItem key={item.id} />);\n\t\t} else {\n\t\t\tchildren.push(<Item key={item.id} id={item.id} name={item.name} />);\n\t\t}\n\t}\n\n\treturn <div {...attributes}>{children}</div>;\n}\n"],"names":["isLoading","data","TheatreAPI","DatabaseAPI","id","params","Item","name","loaded","setLoaded","useState","jsxs","Link","styles","getHot","jsx","THEATRE_CDN","Obfuscated","LoadingItem","clsx","ItemList","items","attributes","children","item"],"mappings":"ykBAsFO,SAASA,EACfC,EACoD,CAC7C,MAAA,YAAaA,GAAQA,EAAK,UAAY,EAC9C,CAEO,MAAMC,UAAmBC,CAAY,CAC3C,MAAM,KAAKC,EAAY,CACtB,OAAO,MAAM,KAAK,MAAoB,aAAaA,CAAE,GAAG,CACzD,CACA,MAAM,MAAMA,EAAY,CACvB,OAAO,MAAM,KAAK,MAAoB,aAAaA,CAAE,SAAU,CAC9D,OAAQ,KAAA,CACR,CACF,CACA,MAAM,SAASC,EAQZ,CACF,OAAO,MAAM,KAAK,MACjB,cAAgB,IAAI,gBAAgB,KAAK,WAAWA,CAAM,CAAC,CAAA,CAE7D,CACD,CAEO,SAASC,EAAK,CAAE,GAAAF,EAAI,KAAAG,GAAsC,CAChE,KAAM,CAACC,EAAQC,CAAS,EAAIC,WAAS,EAAK,EAGzC,OAAAC,EAAA,KAACC,EAAA,CACA,UAAWC,EAAO,KAClB,GAAI,GAAGC,EAAO,gBAAgB,EAAE,IAAI,OAAOV,CAAE,GAC7C,MAAOG,EAEP,SAAA,CAAAQ,EAAAA,IAAC,OAAI,UAAWF,EAAO,UAAW,cAAa,OAAOL,CAAM,EAC3D,SAAAO,EAAA,IAAC,MAAA,CACA,IAAI,GACJ,QAAQ,OACR,OAAQ,IAAMN,EAAU,EAAI,EAC5B,IAAK,IAAI,IAAI,gBAAgBL,CAAE,QAASY,CAAW,EAAE,SAAS,CAAA,CAAA,EAEhE,EACAD,EAAA,IAAC,MAAI,CAAA,UAAWF,EAAO,KACtB,eAACI,EAAW,CAAA,SAAQ,GAAE,SAAAV,CAAA,CAAK,CAC5B,CAAA,CAAA,CAAA,CAAA,CAGH,CAEO,SAASW,GAAc,CAE5B,OAAAP,OAAC,OAAI,UAAWQ,EAAKN,EAAO,KAAMA,EAAO,OAAO,EAC/C,SAAA,CAACE,EAAAA,IAAA,MAAA,CAAI,UAAWF,EAAO,SAAW,CAAA,EACjCE,EAAAA,IAAA,MAAA,CAAI,UAAWF,EAAO,IAAM,CAAA,CAC9B,CAAA,CAAA,CAEF,CAEO,SAASO,EAAS,CACxB,MAAAC,EACA,GAAGC,CACJ,EAEG,CACF,MAAMC,EAAW,CAAA,EAEjB,UAAWC,KAAQH,EACdrB,EAAUwB,CAAI,EACjBD,EAAS,KAAKR,MAACG,EAAiB,CAAA,EAAAM,EAAK,EAAI,CAAE,EAElCD,EAAA,KAAMR,EAAAA,IAAAT,EAAA,CAAmB,GAAIkB,EAAK,GAAI,KAAMA,EAAK,IAAA,EAAjCA,EAAK,EAAkC,CAAE,EAIpE,OAAQT,EAAAA,IAAA,MAAA,CAAK,GAAGO,EAAa,SAAAC,CAAS,CAAA,CACvC"}